name: Abrir Pull Request para develop

on:
    push:
        branches:
            - 'feature/*'
            - 'chore/*'
            - 'fix/*'

jobs:
    open-pull-request:
        runs-on: ubuntu-latest

        steps:
          - name: Checkout code
            uses: actions/checkout@v3
            with:
                fetch-depth: 0
                ref: ${{ github.ref }}

          - name: List Branches available
            run: git branch -a

          - name: Changelog extraction
            id: changelog
            run: |
              CHANGELOG=$(git log origin/develop..HEAD --pretty=format:"- %s" || echo "")
              echo 'CHANGELOG<<EOF' >> $GITHUB_OUTPUT
              echo $CHANGELOG >> $GITHUB_OUTPUT
              echo 'EOF' >> $GITHUB_OUTPUT

          - name: Extract git commit data
            uses: rlespinasse/git-commit-data-action@v1.5.0

          - name: Update Author
            run: echo ${{ env.GIT_COMMIT_AUTHOR_NAME }} > AUTHOR

          - name: Create Pull Request to develop
            uses: peter-evans/create-pull-request@v7.0.8
            with:
                token: ${{ secrets.TOKEN_PR }}
                branch: ${{ github.ref_name }}
                base: develop
                title: 'Automated PR: ${{ github.ref_name }} -> develop'
                body: |
                  Pull request autom√°tico gerado para merge de `${{ github.ref_name }}` em `develop`.

                  ## Changelog
                  ${{ steps.changelog.outputs.CHANGELOG }}
                assignees: Gabriel-dev2
                committer: ${{ env.GIT_COMMIT_AUTHOR_NAME }} <${{ env.GIT_COMMIT_AUTHOR_EMAIL }}">
                author: ${{ env.GIT_COMMIT_AUTHOR_NAME }} <${{ env.GIT_COMMIT_AUTHOR_EMAIL }}">
                draft: false
                delete-branch: true